---
output: 
  github_document
editor_options: 
  chunk_output_type: console
  markdown: 
    wrap: 80
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# planet

[![DOI](https://zenodo.org/badge/157781369.svg)](https://zenodo.org/badge/latestdoi/157781369)

`planet` is an R package for inferring **ethnicity**, **gestational age**, and **cell composition** from placental DNA methylation data [^1](#references)[^2](#references)[^3](#references). 

See full documentation at <https://wvictor14.github.io/planet/>

-   [Installation](#installation)

-   [Usage](#usage)

    -   [Example Data](#example-data)
    -   [Infer Ethnicity](#infer-ethnicity)
    -   [Infer Gestational Age](#infer-gestational-age)
    -   [Infer Cell Composition](#infer-cell-composition)

-   [References](#references---references-)

## Installation

You can install from this github repo with:

```{r eval = FALSE}
devtools::install_github('wvictor14/planet')
```

## Quick Usage

### Example Data

All functions in this package take as input DNAm data. An example dataset, `pl_betas`, is provided to show the format that this data should be in. The output of all `planet` functions is a `data.frame`.

A quick example:

```{r, message = F, warning = F}
library(minfi)
library(tidyverse)
library(planet)

#load example data
data(pl_betas)
data(pl_pDat) # sample information
```

#### Infer Ethnicity

```{r}
pl_infer_ethnicity(pl_betas)
```

#### Infer Gestational Age

There are 3 gestational age clocks for placental DNA methylation data from [Lee
Y. et al. 2019 [^2](#references):

1.  Robust Placental Clock (RPC)
2.  Control Placental Clock (CPC)
3.  Refined Robust Placental Clock (RRPC)

To use a specific one, we can use the `type` argument in `pl_infer_age`:

```{r pl_infer_age, dpi = 200}
pl_infer_age(pl_betas, type = 'RPC')
```

### Infer Cell Composition

To infer cell composition on placental villi DNAm samples, we can use the reference cpgs identified in [^3](#references). These are provided in this package as `pl_cell_cpgs_third` and `pl_cell_cpgs_first` for third trimester (term) and
first trimester samples, respectively.

```{r}
data('pl_cell_cpgs_third')
```

After our reference cpg data is loaded, we can estimate cell composition by applying either the Constrained Projection approach implemented by the R packages `minfi` or `EpiDISH`, or a non-constrained approach by `EpiDish`.

Below I show how to apply deconvolution using `minfi`:

```{r, message = FALSE, warning = FALSE}
minfi:::projectCellType(
  
  # subset your data to cell cpgs
  pl_betas[rownames(pl_cell_cpgs_third),], 
  
  # input the reference cpg matrix
  pl_cell_cpgs_third,
  
  lessThanOne = FALSE)
```

## References

1.  [**Yuan V**, Price EM, Del Gobbo G, Mostafavi S, Cox B, Binder AM, et al. Accurate ethnicity prediction from placental DNA methylation data. Epigenetics & Chromatin. 2019 Aug 9;12(1):51.](https://epigeneticsandchromatin.biomedcentral.com/articles/10.1186/s13072-019-0296-3)

2.  [Lee Y, Choufani S, Weksberg R, Wilson SL, **Yuan V**, et al. Placental epigenetic clocks: estimating gestational age using placental DNA methylation levels. Aging (Albany NY). 2019;11(12):4238â€“4253. doi:10.18632/aging.102049](https://www.ncbi.nlm.nih.gov/pmc/articles/PMC6628997/)

3. [Victor Yuan, Desmond Hui, Yifan Yin et al. Cell-specific Characterization of the Placental Methylome, 29 October 2020, PREPRINT (Version 3) available at Research Square](https://www.researchsquare.com/article/rs-38223/v3)
