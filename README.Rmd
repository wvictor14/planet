---
title: "README"
author: "Victor"
date: "November 15, 2018"
output: 
  md_document:
    toc: true
editor_options: 
  chunk_output_type: console
---

# pl_infer_ethnicity

For inferring ethnicity from placental DNA methylation microarray data. 

### Install

```{r message = F, eval = F}
library(devtools)
install_github('wvictor14/plmec')
```

### Use

#### Example Data

For examples I download some [placental DNAm GEO data](https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE75196) from an study including 
Australian samples. I only use 8/24 samples here, to save on memory.

```{r, message = F}
library(plmec)
library(minfi)
library(wateRmelon)
library(ggplot2)

data(pl_rgset)
pl_rgset # 8 samples
```

Because the data used to train the ethnicity classifier was normalized, I recommend using the same
normalization procedures.

Here I we apply noob and BMIQ normalization to the methylation data, and then combine this with the
65 snp probe data.

```{r}
#normalization
pl_noob <- preprocessNoob(pl_rgset)
pl_bmiq <- BMIQ(pl_noob)

#snp probes
pl_snps <- getSnpBeta(pl_rgset)

#combine methylation and genotyping data
pl_dat <- rbind(pl_bmiq, pl_snps)
dim(pl_dat) # 485577     8
```

#### Infer ethnicity

The reason we added the snp data onto the betas matrix was because a subset of those are used to 
predict ethnicity. The input data needs to contain all 1862 features in the final model. We can
check this with the pl_ethnicity_features vector.

```{r}
all(pl_ethnicity_features %in% rownames(pl_dat))
```

You don't need to subset to these 1862 features before running pl_ethnicity_infer():

```{r}
dim(pl_dat)
results <- pl_infer_ethnicity(pl_dat)
head(results)

qplot(data = results, x = Prob_Caucasian, y = Prob_African, 
     col = Predicted_ethnicity, xlim = c(0,1), ylim = c(0,1))
qplot(data = results, x = Prob_Caucasian, y = Prob_Asian, 
     col = Predicted_ethnicity, xlim = c(0,1), ylim = c(0,1))
```

The results for the whole (n=24) dataset are 22/24 = predicted Caucasian, 2/24 predicted Asian.

We can't compare this to self-reported ethnicity as it is unavailable. But we know these samples 
were collected in Sydney, Australia, and are therefore likely mostly European with some Asian 
ancestries. 

```{r}
table(results$Predicted_ethnicity)
```
