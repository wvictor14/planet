---
output: 
  github_document:
editor_options: 
  chunk_output_type: console
  markdown: 
    wrap: 80
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# planet <img src="man/figures/logo.png" align="right" height = "139" />

<!-- badges: start -->
[![DOI](https://zenodo.org/badge/DOI/10.5281/zenodo.4321633.svg)](https://doi.org/10.5281/zenodo.4321633)
`r badger::badge_lifecycle("maturing", "blue")` `r badger::badge_last_commit("GuangchuangYu/badger")` 
[![R build status](https://github.com/wvictor14/planet/workflows/R-CMD-check/badge.svg)](https://github.com/wvictor14/planet/actions)
<!-- badges: end -->

`planet` is an R package for inferring **ethnicity** (1), **gestational age** (2), and **cell composition** (3) from placental DNA methylation data. 

See full documentation at <https://victor.rbind.io/planet>

### Installation

You can install `planet` from this github repo:

```{r eval = FALSE}
devtools::install_github('wvictor14/planet')
```

### Usage

See [vignettes](https://victor.rbind.io/planet/articles) for more detailed usage.

#### Example Data

All functions in this package take as input DNAm data the 450k and EPIC DNAm microarray. For best performance I suggest providing unfiltered data normalized with noob and BMIQ. A processed example dataset, `pl_betas`, is provided to show the format that this data should be in. The output of all `planet` functions is a `data.frame`.

A quick example of each major function is illustrated with this example data:

```{r, message = F, warning = F}
library(minfi)
library(planet)

#load example data
data(pl_betas)
data(pl_pDat) # sample information
```

#### Infer Ethnicity

```{r}
pl_infer_ethnicity(pl_betas) %>%
  head()
```

#### Infer Gestational Age

There are 3 gestational age clocks for placental DNA methylation data from Lee
Y. et al. 2019 (2). To use a specific one, we can use the `type` argument in `pl_infer_age`:

```{r pl_infer_age, dpi = 200}
pl_infer_age(pl_betas, type = 'RPC') %>%
  head()
```

#### Infer Cell Composition

Reference data to infer cell composition on placental villi DNAm samples (3) can be used with cell deconvolution from minfi or EpiDISH. These are provided in this package as `pl_cell_cpgs_third` and `pl_cell_cpgs_first` for third trimester (term) and first trimester samples, respectively.

```{r}
data('pl_cell_cpgs_third')

minfi:::projectCellType(
  
  # subset your data to cell cpgs
  pl_betas[rownames(pl_cell_cpgs_third),], 
  
  # input the reference cpg matrix
  pl_cell_cpgs_third,
  
  lessThanOne = FALSE) %>%
  
  head()
```

### References

1.  [**Yuan V**, Price EM, Del Gobbo G, Mostafavi S, Cox B, Binder AM, et al. Accurate ethnicity prediction from placental DNA methylation data. Epigenetics & Chromatin. 2019 Aug 9;12(1):51.](https://epigeneticsandchromatin.biomedcentral.com/articles/10.1186/s13072-019-0296-3)

2.  [Lee Y, Choufani S, Weksberg R, Wilson SL, **Yuan V**, et al. Placental epigenetic clocks: estimating gestational age using placental DNA methylation levels. Aging (Albany NY). 2019;11(12):4238â€“4253. doi:10.18632/aging.102049](https://www.ncbi.nlm.nih.gov/pmc/articles/PMC6628997/)

3. [Victor Yuan, Desmond Hui, Yifan Yin et al. Cell-specific Characterization of the Placental Methylome, 29 October 2020, PREPRINT (Version 3) available at Research Square](https://www.researchsquare.com/article/rs-38223/v3)
